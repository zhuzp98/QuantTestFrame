// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © rhapsodyz

//@version=5
indicator("TD Sequential Indicator", overlay=true)

// Define the TD Setup conditions
td_setup_up = close > close[4]
td_setup_dn = close < close[4]

// Initialize the TD Setup counts
var int td_setup_up_count = na
var int td_setup_dn_count = na

// Update the TD Setup counts
if td_setup_up
    td_setup_up_count := nz(td_setup_up_count[1]) + 1
    td_setup_dn_count := na
else
    td_setup_up_count := na

if td_setup_dn
    td_setup_dn_count := nz(td_setup_dn_count[1]) + 1
    td_setup_up_count := na
else
    td_setup_dn_count := na

// Plot the TD Setup counts
plotchar(td_setup_up_count, "TD Setup Up", "", location.abovebar, color.green, size = size.tiny)
plotchar(td_setup_dn_count, "TD Setup Dn", "", location.belowbar, color.red, size = size.tiny)

// Define the TD Countdown conditions
td_countdown_up = td_setup_up_count[1] == 9 and close > ta.valuewhen(td_setup_up, high, 2)[1]
td_countdown_dn = td_setup_dn_count[1] == 9 and close < ta.valuewhen(td_setup_dn, low, 2)[1]

// Initialize the TD Countdown counts
var int td_countdown_up_count = na
var int td_countdown_dn_count = na

// Update the TD Countdown counts
if td_countdown_up
    td_countdown_up_count := nz(td_countdown_up_count[1]) + 1
    td_countdown_dn_count := na
else
    td_countdown_up_count := na

if td_countdown_dn
    td_countdown_dn_count := nz(td_countdown_dn_count[1]) + 1
    td_countdown_up_count := na
else
    td_countdown_dn_count := na

// Plot the TD Countdown counts
plotchar(td_countdown_up_count, "TD Countdown Up", "9", location.abovebar, color.lime, size = size.small)
plotchar(td_countdown_dn_count, "TD Countdown Dn", "9", location.belowbar, color.maroon, size = size.small)
